<h1 class="section-title"><%= trip.trip_name %></h1>
<p class="muted">
  <strong>Dates:</strong>
  <%= trip.start_date ? new Date(trip.start_date).toDateString() : '—' %> →
  <%= trip.end_date ? new Date(trip.end_date).toDateString() : '—' %>
  &nbsp; | &nbsp;
  <strong>Budget:</strong> ₹<%= acost.activitycost|| 0 %>
</p>

<!-- EXPENSES -->
<section id="expenses" class="mt">
  <h2>Expenses</h2>
  <a class="btn ghost" href="/trip/<%= trip.trip_id %>/expenses-summary">
  View Full Expense Report
</a>

  <% if (!expenses.length) { %>
    <div class="alert">No expenses yet.</div>
    <% } else { %>
      <div class="cards">
        <% expenses.forEach(e => { %>
        <article class="card">
          <h3>₹<%= e.amount %> <span class="muted">— <%= e.category_name || 'Uncategorised' %></span></h3>
          <p class="muted">
            <%= e.expense_date || '—' %><br/>
            <%= e.description || '' %>
          </p>
        </article>
      <% }) %>
    </div>
  <% } %>

  <form class="card mt" method="post" action="/trip/<%= trip.trip_id %>/add_expense">
    <h3>Add expense</h3>
    <div class="form-grid">
    <div class="select-wrapper">
      <select name="category_id">
    <option value="">Select Category</option>
    <option value="1">Flight</option>
    <option value="7">Train</option>
    <option value="4">Local Transport</option>
    <option value="2">Hotel</option>
    <option value="3">Food</option>
  </select>
</div>


<input name="amount" type="number" step="0.01" placeholder="Amount" required />
<input name="expense_date" type="date" />
<input name="description" placeholder="Description (optional)" />
</div>
<button class="btn">Add</button>
  </form>
  <form class="upload-card" action="/trip/<%= trip.trip_id %>/upload_image" method="post" enctype="multipart/form-data">
    <h3>Upload media</h3>
    
    <label class="dropzone" id="dz">
      <input class="input-file" type="file" name="media" accept="image/*,video/*" required>
      <div>
        <div>Click to choose or drag & drop</div>
        <div class="hint">JPEG, PNG, MP4, MOV</div>
      </div>
    </label>
    
    <div class="file-meta" id="fileMeta"></div>
    
    <div class="upload-actions">
      <button type="submit" class="btn primary">Upload</button>
      <button type="reset" class="btn ghost">Clear</button>
    </div>
    <div class="media-grid">
      <% images.forEach(img => { %>
        <div class="media-item">
          <% if (img.image_url.endsWith('.mp4') || img.image_url.endsWith('.mov')) { %>
            <video src="<%= img.image_url %>" controls></video>
            <% } else { %>
              <img src="<%= img.image_url %>" alt="">
              <% } %>
              
              <div class="overlay">
                <span class="icon-btn">View</span>
                <form action="/trip/<%= trip.trip_id %>/delete_image/<%= img.image_id %>" method="post">
                  <button class="icon-btn danger" type="submit">Delete</button>
                </form>
              </div>
            </div>
            <% }) %>
          </div>
          
    </form>
       <section id="destinations" class="mt">
            <h2>Destinations</h2>
            <% if (!destinations.length) { %>
              <div class="alert">No destinations yet. Add one below.</div>
            <% } %>
          
            <div class="cards">
              <% destinations.forEach(d => { %>
                <article class="card">
                  <h3><%= d.city_name %> <span class="muted">(<%= d.country || 'Unknown' %>)</span></h3>
                  <p class="muted">
                    From: <%= d.start_city || '—' %><br/>
                     <% const arr= d.arrival_date ? new Date(d.arrival_date).toDateString() : '—' %><br/>
                     <% const dep= d.departure_date ? new Date(d.departure_date).toDateString() : '—' %>
                    Arrive: <%= arr %><br>
          Depart: <%= dep %>
          
                  </p>
                  <footer class="card-foot">
                    <small class="muted">Expense: <%= d.activitycost %></small>
                  </footer>
                </article>
                <% }) %>
              </div>
              
              <form class="card mt" method="post" action="/trip/<%= trip.trip_id %>/add_destination">
                <h3>Add destination</h3>
                <div class="form-grid">
                  <input name="start_city" placeholder="Start city (optional)"/>
                  <input name="city_name" placeholder="City name" required />
                  <input name="country" placeholder="Country" />
                  <input name="arrival_date" type="date" />
                  <input name="departure_date" type="date" />
                </div>
              <button class="btn">Add</button>
            </form>
          </section>   
<!-- ACTIVITIES -->
<section id="activities" class="mt">
  <h2>Activities</h2>
  <% if (!activities.length) { %>
    <div class="alert">No activities yet.</div>
  <% } else { %>
    <div class="cards">
      <% activities.forEach(a => { %>
        <article class="card">
          <h3><%= a.activity_name %></h3>
          <p class="muted">
            City: <%= a.city_name %><br/>
            Date: <%= a.activity_date || '—' %> &nbsp; Time: <%= a.start_time || '—' %><br/>
            Cost: ₹<%= a.booking_cost || 0 %>
          </p>
          <% if (a.description) { %><p><%= a.description %></p><% } %>
        </article>
      <% }) %>
    </div>
  <% } %>

  <form class="card mt" method="post" action="/trip/<%= trip.trip_id %>/add_activity">
    <h3>Add activity</h3>
    <div class="form-grid">
      <select name="destination_id" required>
        <option value="" disabled selected>Select destination</option>
        <% destinations.forEach(d => { %>
          <option value="<%= d.destination_id %>"><%= d.city_name %></option>
        <% }) %>
      </select>
      <input name="activity_name" placeholder="Activity name" required />
      <input name="activity_date" type="date" />
      <input name="start_time" type="time" />
      <input name="booking_cost" type="number" step="1" placeholder="Cost" />
      <input name="description" placeholder="Notes (optional)" />
    </div>
    <button class="btn">Add</button>
  </form>
</section>


</form>



</section>
